{"version":3,"sources":["webpack:///./components/editAlbum/EditCanvas.jsx"],"names":["routesModule","require","EditCanvas","React","Component","constructor","props","state","angle","width","parseInt","height","imageLoading","getEditedImage","album","image","avatar","getImage","toBlob","img","name","split","length","file","File","http","sendFile","routes","UPLOAD_FOTO","then","downloadedFoto","doPost","FOTO_ROUTE","src","_id","result","newPictures","images","push","newAlbum","Object","assign","cleanImage","imageDownloaded","catch","e","Alert","error","response","data","rotateImage","newAngle","calculateParameters","newState","naturalWidth","naturalHeight","setState","onLoad","imgInfo","onImageFailure","closeImage","render","ae"],"mappings":"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","file":"0.f4b91c436befe42cab7c.hot-update.js","sourcesContent":["import React from 'react';\nimport './editCanvas.less';\nimport {CrossIcon, RotateIcon, SaveIcon} from \"../Icons\";\nimport AvatarEditor from \"./ImageRotater\";\nimport * as styles from \"../../constants/styles\";\nconst routesModule = require('../../constants/routes');\nimport http from '../../HttpService';\nimport Alert from 'react-s-alert';\n\nclass EditCanvas extends React.Component {\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            angle: 0,\n            width: parseInt(styles.picture_edit_width),\n            height: parseInt(styles.picture_edit_height),\n            imageLoading: true\n        }\n    }\n\n    getEditedImage() {\n        const {album, image} = this.props;\n        this.avatar.getImage().toBlob(img => {\n            let name = image.split('/');\n            name = name[name.length - 1];\n            const file = new File([img], name);\n\n            http.sendFile(routesModule.routes.UPLOAD_FOTO, file)\n                .then(downloadedFoto => {\n                    http.doPost(routesModule.routes.FOTO_ROUTE, {\n                        src: downloadedFoto.src,\n                        album: album._id\n                    }).then(result => {\n                            const newPictures = [...album.images];\n                            newPictures.push(result);\n                            const newAlbum = Object.assign({}, {\n                                ...album,\n                                images: newPictures,\n                            });\n\n                            this.props.cleanImage({\n                                imageDownloaded: null,\n                                album: newAlbum\n                            });\n                        })\n                        .catch(e => Alert.error(e.response.data.error, {}));;\n                })\n                .catch(e => Alert.error(e.response.data.error, {}));\n        });\n    }\n\n    rotateImage() {\n        const newAngle = this.state.angle + 90;\n        this.calculateParameters(newAngle);\n    }\n\n    calculateParameters(newAngle) {\n        const newState = {\n            height: parseInt(styles.picture_edit_height),\n            angle : newAngle\n        };\n        newState.width = newAngle % 180 == 0\n            ? parseInt(this.naturalWidth * this.state.height / this.naturalHeight)\n            : parseInt(this.naturalHeight * this.state.height / this.naturalWidth);\n        this.setState(newState);\n    }\n\n    onLoad(imgInfo) {\n        this.setState({imageLoading: false});\n        this.naturalWidth = imgInfo.naturalWidth;\n        this.naturalHeight = imgInfo.naturalHeight;\n\n        this.calculateParameters(this.state.angle);\n    }\n\n    onImageFailure() {\n        Alert.error(\"Image loading failed\", {});\n        this.setState({imageLoading: false});\n    }\n\n    closeImage() {\n        this.props.cleanImage({imageDownloaded: false});\n    }\n\n    render() {\n        const {image} = this.props;\n        const {angle, width, height, imageLoading} = this.state;\n        return <div className=\"Edit_canvas\">\n            <AvatarEditor\n                ref={ae => this.avatar = ae}\n                image={image}\n                rotate={angle}\n                width={width}\n                height={height}\n                onLoadSuccess={(imgInfo) => this.onLoad(imgInfo)}\n                onLoadFailure={() => this.onImageFailure()}\n                loading={imageLoading}\n            />\n            <RotateIcon className='rotate_icon' onClick={() => this.rotateImage()}/>\n            <SaveIcon className='save_icon' onClick={() => this.getEditedImage()}/>\n            <CrossIcon className='cross_icon' onClick={() => this.closeImage()}/>\n        </div>\n    }\n}\n\nexport default EditCanvas;\n\n\n\n// WEBPACK FOOTER //\n// ./components/editAlbum/EditCanvas.jsx"],"sourceRoot":""}