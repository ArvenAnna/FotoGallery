{"version":3,"sources":["webpack:///./components/editAlbum/EditCanvas.jsx","webpack:///./components/editAlbum/ImageRotater.jsx","webpack:///./node_modules/react-avatar-editor/dist/index.js"],"names":["routesModule","require","EditCanvas","React","Component","constructor","props","state","angle","width","height","getEditedImage","album","image","avatar","getImage","toBlob","img","name","split","length","file","File","http","sendFile","routes","UPLOAD_FOTO","then","downloadedFoto","doPost","FOTO_ROUTE","src","_id","result","newPictures","images","push","newAlbum","Object","assign","cleanImage","imageDownloaded","rotateImage","newAngle","calculateParameters","setState","parseInt","naturalWidth","naturalHeight","onLoad","imgInfo","resource","onChangeImage","console","log","render","ae","parseDOM","str","parser","DOMParser","parseFromString","retrieveImageURL","dataTransferItems","callback","i","item","type","getAsString","value","doc","querySelector","isTouchDevice","window","navigator","msMaxTouchPoints","isFileAPISupported","draggableEvents","touch","react","down","mouseDown","drag","drop","move","mouseMove","up","mouseUp","native","desktop","deviceEvents","pixelRatio","devicePixelRatio","drawRoundedRect","context","x","y","borderRadius","rect","widthMinusRad","heightMinusRad","translate","arc","Math","PI","lineTo","AvatarEditor","my","mx","handleMouseDown","e","event","preventDefault","handleMouseUp","onMouseUp","handleMouseMove","mousePositionX","targetTouches","pageX","clientX","mousePositionY","pageY","clientY","newState","rotate","scale","lastX","lastY","getCroppingRect","toRadians","degree","cos","sin","relativeWidth","getXScale","relativeHeight","getYScale","position","onPositionChange","onMouseMove","handleDragOver","handleDrop","stopPropagation","dataTransfer","files","items","onDropFile","loadImageFile","retrieveImageUrl","loadImage","setCanvas","canvas","isVertical","getBorders","border","Array","isArray","getDimensions","borderX","borderY","canvasWidth","canvasHeight","cropRect","document","createElement","getContext","drawImage","getImageScaledToCanvas","paintImage","canvasAspect","imageAspect","min","croppingRect","xMin","xMax","yMin","yMax","isLargerThanImage","max","isDataURL","regex","match","loadImageURL","imageURL","imageObj","Image","onload","handleImageReady","bind","onerror","onLoadFailure","crossOrigin","imageFile","reader","FileReader","target","readAsDataURL","componentDidMount","ReactDOM","findDOMNode","paint","nativeEvents","addEventListener","componentWillUnmount","removeEventListener","componentDidUpdate","prevProps","prevState","clearRect","onImageChange","imageState","getInitialSize","onImageReady","onLoadSuccess","newHeight","newWidth","dimensions","canvasRatio","imageRatio","componentWillReceiveProps","newProps","scaleFactor","calculatePosition","save","globalCompositeOperation","restore","fillStyle","color","slice","join","borderSizeX","borderSizeY","beginPath","fill","defaultStyle","cursor","attributes","style","disableDrop","propTypes","PropTypes","number","oneOfType","string","instanceOf","arrayOf","shape","object","oneOf","func","bool","defaultProps"],"mappings":"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","file":"0.96706e0069c0bbf21e57.hot-update.js","sourcesContent":["import React from 'react';\nimport './editCanvas.less';\nimport {RotateIcon, SaveIcon} from \"../Icons\";\nimport AvatarEditor from \"./ImageRotater\";\nconst routesModule = require('../../constants/routes');\nimport http from '../../HttpService';\n\nclass EditCanvas extends React.Component {\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            angle: 0,\n            width: 200,\n            height: 200\n        }\n    }\n\n    getEditedImage() {\n        const {album, image} = this.props;\n        this.avatar.getImage().toBlob(img => {\n            let name = image.split('/');\n            name = name[name.length - 1];\n            const file = new File([img], name);\n\n            http.sendFile(routesModule.routes.UPLOAD_FOTO, file)\n                .then(downloadedFoto => {\n                    http.doPost(routesModule.routes.FOTO_ROUTE, {\n                        src: downloadedFoto.src,\n                        album: album._id\n                    }).then(result => {\n                            const newPictures = [...album.images];\n                            newPictures.push(result);\n                            const newAlbum = Object.assign({}, {\n                                ...album,\n                                images: newPictures,\n                            });\n\n                            this.props.cleanImage({\n                                imageDownloaded: null,\n                                album: newAlbum\n                            });\n                        });\n                });\n        });\n    }\n\n    rotateImage() {\n        const newAngle = this.state.angle + 90;\n        this.calculateParameters(newAngle);\n    }\n\n    calculateParameters(newAngle) {\n        if(newAngle % 180 == 0) {\n            this.setState({\n                width: parseInt(this.naturalWidth * this.state.height / this.naturalHeight),\n                height: 200,\n                angle : newAngle\n            });\n        } else {\n            this.setState({\n                height: parseInt(this.naturalHeight * this.state.height / this.naturalWidth),\n                width: 200,\n                // width: parseInt(this.naturalHeight * this.state.height / this.naturalWidth),\n                // height: 200,\n                angle : newAngle\n            });\n        }\n    }\n\n    onLoad(imgInfo) {\n        this.naturalWidth = imgInfo.resource.naturalWidth;\n        this.naturalHeight = imgInfo.resource.naturalHeight;\n\n        this.calculateParameters(this.state.angle);\n        // this.setState({\n        //     width: imgInfo.resource.naturalWidth * this.state.height / imgInfo.resource.naturalHeight,\n        // });\n    }\n\n    onChangeImage() {\n        console.log('===========');\n    }\n\n    render() {\n        const {image} = this.props;\n        const {angle, width, height} = this.state;\n        return <div className=\"Edit_canvas\">\n            <AvatarEditor\n                ref={ae => this.avatar = ae}\n                image={image}\n                rotate={angle}\n                width={width}\n                height={height}\n                onLoadSuccess={(imgInfo) => this.onLoad(imgInfo)}\n                //onImageChange={() => this.onChangeImage()}\n                // onDropFile={() => this.onChangeImage()}\n                // onImageReady={() => this.onChangeImage()}\n                //\n                // onPositionChange={() => this.onChangeImage()}\n\n            />\n            <RotateIcon className='rotate_icon' onClick={() => this.rotateImage()}/>\n            <SaveIcon className='save_icon' onClick={() => this.getEditedImage()}/></div>\n    }\n}\n\nexport default EditCanvas;\n\n\n\n// WEBPACK FOOTER //\n// ./components/editAlbum/EditCanvas.jsx","import PropTypes from 'prop-types';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\n\nconst parseDOM = (str) => {\n    const parser = typeof DOMParser === 'undefined' ? null : new DOMParser()\n\n    if (!parser) {\n        return null\n    }\n\n    return parser.parseFromString(str, 'text/html')\n}\n\nconst retrieveImageURL = (dataTransferItems, callback) => {\n    for (let i = 0; i < dataTransferItems.length; i++) {\n        let item = dataTransferItems[i]\n\n        if (item.type === 'text/html') {\n            item.getAsString(value => {\n                const doc = parseDOM(value)\n                const img = doc.querySelector('img')\n                if (img && img.src) {\n                    callback(img.src)\n                }\n            })\n            break\n        }\n    }\n}\n\nconst isTouchDevice = !!(\n    typeof window !== 'undefined' &&\n    typeof navigator !== 'undefined' &&\n    ('ontouchstart' in window || navigator.msMaxTouchPoints > 0)\n)\n\nconst isFileAPISupported = typeof File !== 'undefined'\n\nconst draggableEvents = {\n    touch: {\n        react: {\n            down: 'onTouchStart',\n            mouseDown: 'onMouseDown',\n            drag: 'onTouchMove',\n            drop: 'onTouchEnd',\n            move: 'onTouchMove',\n            mouseMove: 'onMouseMove',\n            up: 'onTouchEnd',\n            mouseUp: 'onMouseUp'\n        },\n        native: {\n            down: 'touchstart',\n            mouseDown: 'mousedown',\n            drag: 'touchmove',\n            drop: 'touchend',\n            move: 'touchmove',\n            mouseMove: 'mousemove',\n            up: 'touchend',\n            mouseUp: 'mouseup'\n        }\n    },\n    desktop: {\n        react: {\n            down: 'onMouseDown',\n            drag: 'onDragOver',\n            drop: 'onDrop',\n            move: 'onMouseMove',\n            up: 'onMouseUp'\n        },\n        native: {\n            down: 'mousedown',\n            drag: 'dragStart',\n            drop: 'drop',\n            move: 'mousemove',\n            up: 'mouseup'\n        }\n    }\n}\nconst deviceEvents = isTouchDevice\n    ? draggableEvents.touch\n    : draggableEvents.desktop\n\nconst pixelRatio =\n    typeof window !== 'undefined' && window.devicePixelRatio\n        ? window.devicePixelRatio\n        : 1\n\n// Draws a rounded rectangle on a 2D context.\nconst drawRoundedRect = (context, x, y, width, height, borderRadius) => {\n    if (borderRadius === 0) {\n        context.rect(x, y, width, height)\n    } else {\n        const widthMinusRad = width - borderRadius\n        const heightMinusRad = height - borderRadius\n        context.translate(x, y)\n        context.arc(\n            borderRadius,\n            borderRadius,\n            borderRadius,\n            Math.PI,\n            Math.PI * 1.5\n        )\n        context.lineTo(widthMinusRad, 0)\n        context.arc(\n            widthMinusRad,\n            borderRadius,\n            borderRadius,\n            Math.PI * 1.5,\n            Math.PI * 2\n        )\n        context.lineTo(width, heightMinusRad)\n        context.arc(\n            widthMinusRad,\n            heightMinusRad,\n            borderRadius,\n            Math.PI * 2,\n            Math.PI * 0.5\n        )\n        context.lineTo(borderRadius, height)\n        context.arc(\n            borderRadius,\n            heightMinusRad,\n            borderRadius,\n            Math.PI * 0.5,\n            Math.PI\n        )\n        context.translate(-x, -y)\n    }\n}\n\nclass AvatarEditor extends React.Component {\n    static propTypes = {\n        scale: PropTypes.number,\n        rotate: PropTypes.number,\n        image: PropTypes.oneOfType([\n            PropTypes.string,\n            ...(isFileAPISupported ? [PropTypes.instanceOf(File)] : [])\n        ]),\n        border: PropTypes.oneOfType([\n            PropTypes.number,\n            PropTypes.arrayOf(PropTypes.number)\n        ]),\n        borderRadius: PropTypes.number,\n        width: PropTypes.number,\n        height: PropTypes.number,\n        position: PropTypes.shape({\n            x: PropTypes.number,\n            y: PropTypes.number\n        }),\n        color: PropTypes.arrayOf(PropTypes.number),\n        style: PropTypes.object,\n        crossOrigin: PropTypes.oneOf(['', 'anonymous', 'use-credentials']),\n\n        onDropFile: PropTypes.func,\n        onLoadFailure: PropTypes.func,\n        onLoadSuccess: PropTypes.func,\n        onImageReady: PropTypes.func,\n        onImageChange: PropTypes.func,\n        onMouseUp: PropTypes.func,\n        onMouseMove: PropTypes.func,\n        onPositionChange: PropTypes.func,\n\n        disableDrop: PropTypes.bool\n    }\n\n    static defaultProps = {\n        disableDrop: false,\n        scale: 1,\n        rotate: 0,\n        border: 25,\n        borderRadius: 0,\n        width: 200,\n        height: 200,\n        color: [0, 0, 0, 0.5],\n        style: {},\n        onDropFile () {},\n        onLoadFailure () {},\n        onLoadSuccess () {},\n        onImageReady () {},\n        onImageChange () {},\n        onMouseUp () {},\n        onMouseMove () {},\n        onPositionChange () {}\n    }\n\n    state = {\n        drag: false,\n        my: null,\n        mx: null,\n        image: {\n            x: 0.5,\n            y: 0.5\n        }\n    }\n\n    isVertical () {\n        return this.props.rotate % 180 !== 0\n    }\n\n    getBorders (border = this.props.border) {\n        return Array.isArray(border) ? border : [border, border]\n    }\n\n    getDimensions () {\n        const { width, height, rotate, border } = this.props\n\n        const canvas = {}\n\n        const [borderX, borderY] = this.getBorders(border)\n\n        const canvasWidth = width\n        const canvasHeight = height\n\n        if (this.isVertical()) {\n            canvas.width = canvasHeight\n            canvas.height = canvasWidth\n        } else {\n            canvas.width = canvasWidth\n            canvas.height = canvasHeight\n        }\n\n        canvas.width += borderX * 2\n        canvas.height += borderY * 2\n\n        return {\n            canvas,\n            rotate,\n            width,\n            height,\n            border\n        }\n    }\n\n    getImage () {\n        // get relative coordinates (0 to 1)\n        const cropRect = this.getCroppingRect()\n        const image = this.state.image\n\n        // get actual pixel coordinates\n        cropRect.x *= image.resource.width\n        cropRect.y *= image.resource.height\n        cropRect.width *= image.resource.width\n        cropRect.height *= image.resource.height\n\n        // create a canvas with the correct dimensions\n        const canvas = document.createElement('canvas')\n\n        if (this.isVertical()) {\n            canvas.width = cropRect.height\n            canvas.height = cropRect.width\n        } else {\n            canvas.width = cropRect.width\n            canvas.height = cropRect.height\n        }\n\n        // draw the full-size image at the correct position,\n        // the image gets truncated to the size of the canvas.\n        const context = canvas.getContext('2d')\n\n        context.translate(canvas.width / 2, canvas.height / 2)\n        context.rotate(this.props.rotate * Math.PI / 180)\n        context.translate(-(canvas.width / 2), -(canvas.height / 2))\n\n        if (this.isVertical()) {\n            context.translate(\n                (canvas.width - canvas.height) / 2,\n                (canvas.height - canvas.width) / 2\n            )\n        }\n\n        context.drawImage(image.resource, -cropRect.x, -cropRect.y)\n\n        return canvas\n    }\n\n    /**\n     * Get the image scaled to original canvas size.\n     * This was default in 4.x and is now kept as a legacy method.\n     */\n    getImageScaledToCanvas () {\n        const { width, height } = this.getDimensions()\n\n        const canvas = document.createElement('canvas')\n\n        if (this.isVertical()) {\n            canvas.width = height\n            canvas.height = width\n        } else {\n            canvas.width = width\n            canvas.height = height\n        }\n\n        // don't paint a border here, as it is the resulting image\n        this.paintImage(canvas.getContext('2d'), this.state.image, 0, 1)\n\n        return canvas\n    }\n\n    getXScale () {\n        const canvasAspect = this.props.width / this.props.height\n        const imageAspect = this.state.image.width / this.state.image.height\n\n        return Math.min(1, canvasAspect / imageAspect)\n    }\n\n    getYScale () {\n        const canvasAspect = this.props.height / this.props.width\n        const imageAspect = this.state.image.height / this.state.image.width\n\n        return Math.min(1, canvasAspect / imageAspect)\n    }\n\n    getCroppingRect () {\n        const position = this.props.position || {\n                x: this.state.image.x,\n                y: this.state.image.y\n            }\n        const width = 1 / this.props.scale * this.getXScale()\n        const height = 1 / this.props.scale * this.getYScale()\n\n        const croppingRect = {\n            x: position.x - width / 2,\n            y: position.y - height / 2,\n            width,\n            height\n        }\n\n        let xMin = 0\n        let xMax = 1 - croppingRect.width\n        let yMin = 0\n        let yMax = 1 - croppingRect.height\n\n        // If the cropping rect is larger than the image, then we need to change\n        // our maxima & minima for x & y to allow the image to appear anywhere up\n        // to the very edge of the cropping rect.\n        const isLargerThanImage = width > 1 || height > 1\n\n        if (isLargerThanImage) {\n            xMin = -croppingRect.width\n            xMax = 1\n            yMin = -croppingRect.height\n            yMax = 1\n        }\n\n        return {\n            ...croppingRect,\n            x: Math.max(xMin, Math.min(croppingRect.x, xMax)),\n            y: Math.max(yMin, Math.min(croppingRect.y, yMax))\n        }\n    }\n\n    isDataURL (str) {\n        if (str === null) {\n            return false\n        }\n        const regex = /^\\s*data:([a-z]+\\/[a-z]+(;[a-z-]+=[a-z-]+)?)?(;base64)?,[a-z0-9!$&',()*+;=\\-._~:@/?%\\s]*\\s*$/i\n        return !!str.match(regex)\n    }\n\n    loadImage (image) {\n        if (isFileAPISupported && image instanceof File) {\n            this.loadImageFile(image)\n        } else if (typeof image === 'string') {\n            this.loadImageURL(image)\n        }\n    }\n\n    loadImageURL (imageURL) {\n        const imageObj = new Image()\n        imageObj.onload = this.handleImageReady.bind(this, imageObj)\n        imageObj.onerror = this.props.onLoadFailure\n        if (!this.isDataURL(imageURL) && this.props.crossOrigin) { imageObj.crossOrigin = this.props.crossOrigin }\n        imageObj.src = imageURL\n    }\n\n    loadImageFile (imageFile) {\n        const reader = new FileReader()\n        reader.onload = e => this.loadImageURL(e.target.result)\n        reader.readAsDataURL(imageFile)\n    }\n\n    componentDidMount () {\n        const context = ReactDOM.findDOMNode(this.canvas).getContext('2d')\n        if (this.props.image) {\n            this.loadImage(this.props.image)\n        }\n        this.paint(context)\n        if (document) {\n            const nativeEvents = deviceEvents.native\n            document.addEventListener(nativeEvents.move, this.handleMouseMove, false)\n            document.addEventListener(nativeEvents.up, this.handleMouseUp, false)\n            if (isTouchDevice) {\n                document.addEventListener(\n                    nativeEvents.mouseMove,\n                    this.handleMouseMove,\n                    false\n                )\n                document.addEventListener(\n                    nativeEvents.mouseUp,\n                    this.handleMouseUp,\n                    false\n                )\n            }\n        }\n    }\n\n    componentWillUnmount () {\n        if (document) {\n            const nativeEvents = deviceEvents.native\n            document.removeEventListener(\n                nativeEvents.move,\n                this.handleMouseMove,\n                false\n            )\n            document.removeEventListener(nativeEvents.up, this.handleMouseUp, false)\n            if (isTouchDevice) {\n                document.removeEventListener(\n                    nativeEvents.mouseMove,\n                    this.handleMouseMove,\n                    false\n                )\n                document.removeEventListener(\n                    nativeEvents.mouseUp,\n                    this.handleMouseUp,\n                    false\n                )\n            }\n        }\n    }\n\n    componentDidUpdate (prevProps, prevState) {\n        const canvas = ReactDOM.findDOMNode(this.canvas)\n        const context = canvas.getContext('2d')\n        context.clearRect(0, 0, canvas.width, canvas.height)\n        this.paint(context)\n        this.paintImage(context, this.state.image, this.props.border)\n\n        if (\n            prevProps.image !== this.props.image ||\n            prevProps.width !== this.props.width ||\n            prevProps.height !== this.props.height ||\n            prevProps.position !== this.props.position ||\n            prevProps.scale !== this.props.scale ||\n            prevProps.rotate !== this.props.rotate ||\n            prevState.my !== this.state.my ||\n            prevState.mx !== this.state.mx ||\n            prevState.image.x !== this.state.image.x ||\n            prevState.image.y !== this.state.image.y\n        ) {\n            this.props.onImageChange()\n        }\n    }\n\n    handleImageReady (image) {\n        const imageState = this.getInitialSize(image.width, image.height)\n        imageState.resource = image\n        imageState.x = 0.5\n        imageState.y = 0.5\n        this.setState({ drag: false, image: imageState }, this.props.onImageReady)\n        this.props.onLoadSuccess(imageState)\n    }\n\n    getInitialSize (width, height) {\n        let newHeight\n        let newWidth\n\n        const dimensions = this.getDimensions()\n        const canvasRatio = dimensions.height / dimensions.width\n        const imageRatio = height / width\n\n        if (canvasRatio > imageRatio) {\n            newHeight = this.getDimensions().height\n            newWidth = width * (newHeight / height)\n        } else {\n            newWidth = this.getDimensions().width\n            newHeight = height * (newWidth / width)\n        }\n\n        return {\n            height: newHeight,\n            width: newWidth\n        }\n    }\n\n    componentWillReceiveProps (newProps) {\n        if (\n            (newProps.image && this.props.image !== newProps.image) ||\n            this.props.width !== newProps.width ||\n            this.props.height !== newProps.height\n        ) {\n            this.loadImage(newProps.image)\n        }\n    }\n\n    paintImage (context, image, border, scaleFactor = pixelRatio) {\n        if (image.resource) {\n            const position = this.calculatePosition(image, border)\n\n            context.save()\n\n            context.translate(context.canvas.width / 2, context.canvas.height / 2)\n            context.rotate(this.props.rotate * Math.PI / 180)\n            context.translate(\n                -(context.canvas.width / 2),\n                -(context.canvas.height / 2)\n            )\n\n            if (this.isVertical()) {\n                context.translate(\n                    (context.canvas.width - context.canvas.height) / 2,\n                    (context.canvas.height - context.canvas.width) / 2\n                )\n            }\n\n            context.scale(scaleFactor, scaleFactor)\n\n            context.globalCompositeOperation = 'destination-over'\n            context.drawImage(\n                image.resource,\n                position.x,\n                position.y,\n                position.width,\n                position.height\n            )\n\n            context.restore()\n        }\n    }\n\n    calculatePosition (image, border) {\n        image = image || this.state.image\n\n        const [borderX, borderY] = this.getBorders(border)\n\n        const croppingRect = this.getCroppingRect()\n\n        const width = image.width * this.props.scale\n        const height = image.height * this.props.scale\n\n        let x = -croppingRect.x * width\n        let y = -croppingRect.y * height\n\n        if (this.isVertical()) {\n            x += borderY\n            y += borderX\n        } else {\n            x += borderX\n            y += borderY\n        }\n\n        return {\n            x,\n            y,\n            height,\n            width\n        }\n    }\n\n    paint (context) {\n        context.save()\n        context.scale(pixelRatio, pixelRatio)\n        context.translate(0, 0)\n        context.fillStyle = 'rgba(' + this.props.color.slice(0, 4).join(',') + ')'\n\n        let borderRadius = this.props.borderRadius\n        const dimensions = this.getDimensions()\n        const [borderSizeX, borderSizeY] = this.getBorders(dimensions.border)\n        const height = dimensions.canvas.height\n        const width = dimensions.canvas.width\n\n        // clamp border radius between zero (perfect rectangle) and half the size without borders (perfect circle or \"pill\")\n        borderRadius = Math.max(borderRadius, 0)\n        borderRadius = Math.min(\n            borderRadius,\n            width / 2 - borderSizeX,\n            height / 2 - borderSizeY\n        )\n\n        context.beginPath()\n        // inner rect, possibly rounded\n        drawRoundedRect(\n            context,\n            borderSizeX,\n            borderSizeY,\n            width - borderSizeX * 2,\n            height - borderSizeY * 2,\n            borderRadius\n        )\n        context.rect(width, 0, -width, height) // outer rect, drawn \"counterclockwise\"\n        context.fill('evenodd')\n\n        context.restore()\n    }\n\n    handleMouseDown = (e) => {\n        e = e || window.event\n        // if e is a touch event, preventDefault keeps\n        // corresponding mouse events from also being fired\n        // later.\n        e.preventDefault()\n        this.setState({\n            drag: true,\n            mx: null,\n            my: null\n        })\n    }\n    handleMouseUp = () => {\n        if (this.state.drag) {\n            this.setState({ drag: false })\n            this.props.onMouseUp()\n        }\n    }\n\n    handleMouseMove = (e) => {\n        e = e || window.event\n        if (this.state.drag === false) {\n            return\n        }\n\n        const mousePositionX = e.targetTouches\n            ? e.targetTouches[0].pageX\n            : e.clientX\n        const mousePositionY = e.targetTouches\n            ? e.targetTouches[0].pageY\n            : e.clientY\n\n        const newState = {\n            mx: mousePositionX,\n            my: mousePositionY\n        }\n\n        let rotate = this.props.rotate\n\n        rotate %= 360\n        rotate = rotate < 0 ? rotate + 360 : rotate\n\n        if (this.state.mx && this.state.my) {\n            const mx = this.state.mx - mousePositionX\n            const my = this.state.my - mousePositionY\n\n            const width = this.state.image.width * this.props.scale\n            const height = this.state.image.height * this.props.scale\n\n            let { x: lastX, y: lastY } = this.getCroppingRect()\n\n            lastX *= width\n            lastY *= height\n\n            // helpers to calculate vectors\n            const toRadians = degree => degree * (Math.PI / 180)\n            const cos = Math.cos(toRadians(rotate))\n            const sin = Math.sin(toRadians(rotate))\n\n            const x = lastX + mx * cos + my * sin\n            const y = lastY + -mx * sin + my * cos\n\n            const relativeWidth = 1 / this.props.scale * this.getXScale()\n            const relativeHeight = 1 / this.props.scale * this.getYScale()\n\n            const position = {\n                x: x / width + relativeWidth / 2,\n                y: y / height + relativeHeight / 2\n            }\n\n            this.props.onPositionChange(position)\n\n            newState.image = {\n                ...this.state.image,\n                ...position\n            }\n        }\n\n        this.setState(newState)\n\n        this.props.onMouseMove(e)\n    }\n\n    handleDragOver = (e) => {\n        e = e || window.event\n        e.preventDefault()\n    }\n\n    handleDrop = (e = window.event) => {\n        e.stopPropagation()\n        e.preventDefault()\n\n        if (e.dataTransfer) {\n            const { files, items } = e.dataTransfer\n\n            if (files && files.length) {\n                this.props.onDropFile(e)\n                this.loadImageFile(files[0])\n            } else if (items && items.length) {\n                retrieveImageUrl(items, src => this.loadImage(src))\n            }\n        }\n    }\n\n    setCanvas = (canvas) => {\n        this.canvas = canvas\n    }\n\n    render () {\n        const dimensions = this.getDimensions()\n        const defaultStyle = {\n            width: dimensions.canvas.width,\n            height: dimensions.canvas.height,\n            cursor: this.state.drag ? 'grabbing' : 'grab'\n        }\n\n        const attributes = {\n            width: dimensions.canvas.width * pixelRatio,\n            height: dimensions.canvas.height * pixelRatio,\n            style: {\n                ...defaultStyle,\n                ...this.props.style\n            }\n        }\n\n        attributes[deviceEvents.react.down] = this.handleMouseDown\n        attributes[deviceEvents.react.drag] = this.handleDragOver\n        if (!this.props.disableDrop) { attributes[deviceEvents.react.drop] = this.handleDrop }\n        if (isTouchDevice) { attributes[deviceEvents.react.mouseDown] = this.handleMouseDown }\n\n        return <canvas ref={this.setCanvas} {...attributes} />\n    }\n}\n\nexport default AvatarEditor\n\n\n\n// WEBPACK FOOTER //\n// ./components/editAlbum/ImageRotater.jsx","!function(e,t){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=t(require(\"prop-types\"),require(\"react\"),require(\"react-dom\")):\"function\"==typeof define&&define.amd?define([\"prop-types\",\"react\",\"react-dom\"],t):e.AvatarEditor=t(e.PropTypes,e.React,e.ReactDOM)}(this,function(e,t,o){\"use strict\";function a(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function n(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}function i(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}e=e&&e.hasOwnProperty(\"default\")?e.default:e,t=t&&t.hasOwnProperty(\"default\")?t.default:t,o=o&&o.hasOwnProperty(\"default\")?o.default:o;var r=function(e){var t=\"undefined\"==typeof DOMParser?null:new DOMParser;return t?t.parseFromString(e,\"text/html\"):null},s=function(e,t){for(var o=0;o<e.length;o++){var a=e[o];if(\"text/html\"===a.type){a.getAsString(function(e){var o=r(e).querySelector(\"img\");o&&o.src&&t(o.src)});break}}},h=function(){function e(e,t){var o=[],a=!0,n=!1,i=void 0;try{for(var r,s=e[Symbol.iterator]();!(a=(r=s.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){n=!0,i=e}finally{try{!a&&s.return&&s.return()}finally{if(n)throw i}}return o}return function(t,o){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,o);throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}}(),u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(e[a]=o[a])}return e},c=function(){function e(e,t){for(var o=0;o<t.length;o++){var a=t[o];a.enumerable=a.enumerable||!1,a.configurable=!0,\"value\"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,o,a){return o&&e(t.prototype,o),a&&e(t,a),t}}(),d=!(\"undefined\"==typeof window||\"undefined\"==typeof navigator||!(\"ontouchstart\"in window||navigator.msMaxTouchPoints>0)),p=\"undefined\"!=typeof File,l={touch:{react:{down:\"onTouchStart\",mouseDown:\"onMouseDown\",drag:\"onTouchMove\",drop:\"onTouchEnd\",move:\"onTouchMove\",mouseMove:\"onMouseMove\",up:\"onTouchEnd\",mouseUp:\"onMouseUp\"},native:{down:\"touchstart\",mouseDown:\"mousedown\",drag:\"touchmove\",drop:\"touchend\",move:\"touchmove\",mouseMove:\"mousemove\",up:\"touchend\",mouseUp:\"mouseup\"}},desktop:{react:{down:\"onMouseDown\",drag:\"onDragOver\",drop:\"onDrop\",move:\"onMouseMove\",up:\"onMouseUp\"},native:{down:\"mousedown\",drag:\"dragStart\",drop:\"drop\",move:\"mousemove\",up:\"mouseup\"}}},g=d?l.touch:l.desktop,m=\"undefined\"!=typeof window&&window.devicePixelRatio?window.devicePixelRatio:1,v=function(e,t,o,a,n,i){if(0===i)e.rect(t,o,a,n);else{var r=a-i,s=n-i;e.translate(t,o),e.arc(i,i,i,Math.PI,1.5*Math.PI),e.lineTo(r,0),e.arc(r,i,i,1.5*Math.PI,2*Math.PI),e.lineTo(a,s),e.arc(r,s,i,2*Math.PI,.5*Math.PI),e.lineTo(i,n),e.arc(i,s,i,.5*Math.PI,Math.PI),e.translate(-t,-o)}},f=function(e){function r(){var e,t,o,i;a(this,r);for(var h=arguments.length,c=Array(h),d=0;d<h;d++)c[d]=arguments[d];return t=o=n(this,(e=r.__proto__||Object.getPrototypeOf(r)).call.apply(e,[this].concat(c))),o.state={drag:!1,my:null,mx:null,image:{x:.5,y:.5}},o.handleMouseDown=function(e){(e=e||window.event).preventDefault(),o.setState({drag:!0,mx:null,my:null})},o.handleMouseUp=function(){o.state.drag&&(o.setState({drag:!1}),o.props.onMouseUp())},o.handleMouseMove=function(e){if(e=e||window.event,!1!==o.state.drag){var t=e.targetTouches?e.targetTouches[0].pageX:e.clientX,a=e.targetTouches?e.targetTouches[0].pageY:e.clientY,n={mx:t,my:a},i=o.props.rotate;if(i%=360,i=i<0?i+360:i,o.state.mx&&o.state.my){var r=o.state.mx-t,s=o.state.my-a,h=o.state.image.width*o.props.scale,c=o.state.image.height*o.props.scale,d=o.getCroppingRect(),p=d.x,l=d.y;p*=h,l*=c;var g=function(e){return e*(Math.PI/180)},m=Math.cos(g(i)),v=Math.sin(g(i)),f=l+-r*v+s*m,y={x:(p+r*m+s*v)/h+1/o.props.scale*o.getXScale()/2,y:f/c+1/o.props.scale*o.getYScale()/2};o.props.onPositionChange(y),n.image=u({},o.state.image,y)}o.setState(n),o.props.onMouseMove(e)}},o.handleDragOver=function(e){(e=e||window.event).preventDefault()},o.handleDrop=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.event;if(e.stopPropagation(),e.preventDefault(),e.dataTransfer){var t=e.dataTransfer,a=t.files,n=t.items;a&&a.length?(o.props.onDropFile(e),o.loadImageFile(a[0])):n&&n.length&&s(n,function(e){return o.loadImage(e)})}},o.setCanvas=function(e){o.canvas=e},i=t,n(o,i)}return i(r,t.Component),c(r,[{key:\"isVertical\",value:function(){return this.props.rotate%180!=0}},{key:\"getBorders\",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props.border;return Array.isArray(e)?e:[e,e]}},{key:\"getDimensions\",value:function(){var e=this.props,t=e.width,o=e.height,a=e.rotate,n=e.border,i={},r=this.getBorders(n),s=h(r,2),u=s[0],c=s[1],d=t,p=o;return this.isVertical()?(i.width=p,i.height=d):(i.width=d,i.height=p),i.width+=2*u,i.height+=2*c,{canvas:i,rotate:a,width:t,height:o,border:n}}},{key:\"getImage\",value:function(){var e=this.getCroppingRect(),t=this.state.image;e.x*=t.resource.width,e.y*=t.resource.height,e.width*=t.resource.width,e.height*=t.resource.height;var o=document.createElement(\"canvas\");this.isVertical()?(o.width=e.height,o.height=e.width):(o.width=e.width,o.height=e.height);var a=o.getContext(\"2d\");return a.translate(o.width/2,o.height/2),a.rotate(this.props.rotate*Math.PI/180),a.translate(-o.width/2,-o.height/2),this.isVertical()&&a.translate((o.width-o.height)/2,(o.height-o.width)/2),a.drawImage(t.resource,-e.x,-e.y),o}},{key:\"getImageScaledToCanvas\",value:function(){var e=this.getDimensions(),t=e.width,o=e.height,a=document.createElement(\"canvas\");return this.isVertical()?(a.width=o,a.height=t):(a.width=t,a.height=o),this.paintImage(a.getContext(\"2d\"),this.state.image,0,1),a}},{key:\"getXScale\",value:function(){var e=this.props.width/this.props.height,t=this.state.image.width/this.state.image.height;return Math.min(1,e/t)}},{key:\"getYScale\",value:function(){var e=this.props.height/this.props.width,t=this.state.image.height/this.state.image.width;return Math.min(1,e/t)}},{key:\"getCroppingRect\",value:function(){var e=this.props.position||{x:this.state.image.x,y:this.state.image.y},t=1/this.props.scale*this.getXScale(),o=1/this.props.scale*this.getYScale(),a={x:e.x-t/2,y:e.y-o/2,width:t,height:o},n=0,i=1-a.width,r=0,s=1-a.height;return(t>1||o>1)&&(n=-a.width,i=1,r=-a.height,s=1),u({},a,{x:Math.max(n,Math.min(a.x,i)),y:Math.max(r,Math.min(a.y,s))})}},{key:\"isDataURL\",value:function(e){if(null===e)return!1;var t=/^\\s*data:([a-z]+\\/[a-z]+(;[a-z-]+=[a-z-]+)?)?(;base64)?,[a-z0-9!$&',()*+;=\\-._~:@/?%\\s]*\\s*$/i;return!!e.match(t)}},{key:\"loadImage\",value:function(e){p&&e instanceof File?this.loadImageFile(e):\"string\"==typeof e&&this.loadImageURL(e)}},{key:\"loadImageURL\",value:function(e){var t=new Image;t.onload=this.handleImageReady.bind(this,t),t.onerror=this.props.onLoadFailure,!this.isDataURL(e)&&this.props.crossOrigin&&(t.crossOrigin=this.props.crossOrigin),t.src=e}},{key:\"loadImageFile\",value:function(e){var t=this,o=new FileReader;o.onload=function(e){return t.loadImageURL(e.target.result)},o.readAsDataURL(e)}},{key:\"componentDidMount\",value:function(){var e=o.findDOMNode(this.canvas).getContext(\"2d\");if(this.props.image&&this.loadImage(this.props.image),this.paint(e),document){var t=g.native;document.addEventListener(t.move,this.handleMouseMove,!1),document.addEventListener(t.up,this.handleMouseUp,!1),d&&(document.addEventListener(t.mouseMove,this.handleMouseMove,!1),document.addEventListener(t.mouseUp,this.handleMouseUp,!1))}}},{key:\"componentWillUnmount\",value:function(){if(document){var e=g.native;document.removeEventListener(e.move,this.handleMouseMove,!1),document.removeEventListener(e.up,this.handleMouseUp,!1),d&&(document.removeEventListener(e.mouseMove,this.handleMouseMove,!1),document.removeEventListener(e.mouseUp,this.handleMouseUp,!1))}}},{key:\"componentDidUpdate\",value:function(e,t){var a=o.findDOMNode(this.canvas),n=a.getContext(\"2d\");n.clearRect(0,0,a.width,a.height),this.paint(n),this.paintImage(n,this.state.image,this.props.border),e.image===this.props.image&&e.width===this.props.width&&e.height===this.props.height&&e.position===this.props.position&&e.scale===this.props.scale&&e.rotate===this.props.rotate&&t.my===this.state.my&&t.mx===this.state.mx&&t.image.x===this.state.image.x&&t.image.y===this.state.image.y||this.props.onImageChange()}},{key:\"handleImageReady\",value:function(e){var t=this.getInitialSize(e.width,e.height);t.resource=e,t.x=.5,t.y=.5,this.setState({drag:!1,image:t},this.props.onImageReady),this.props.onLoadSuccess(t)}},{key:\"getInitialSize\",value:function(e,t){var o=void 0,a=void 0,n=this.getDimensions();return n.height/n.width>t/e?a=e*((o=this.getDimensions().height)/t):o=t*((a=this.getDimensions().width)/e),{height:o,width:a}}},{key:\"componentWillReceiveProps\",value:function(e){(e.image&&this.props.image!==e.image||this.props.width!==e.width||this.props.height!==e.height)&&this.loadImage(e.image)}},{key:\"paintImage\",value:function(e,t,o){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:m;if(t.resource){var n=this.calculatePosition(t,o);e.save(),e.translate(e.canvas.width/2,e.canvas.height/2),e.rotate(this.props.rotate*Math.PI/180),e.translate(-e.canvas.width/2,-e.canvas.height/2),this.isVertical()&&e.translate((e.canvas.width-e.canvas.height)/2,(e.canvas.height-e.canvas.width)/2),e.scale(a,a),e.globalCompositeOperation=\"destination-over\",e.drawImage(t.resource,n.x,n.y,n.width,n.height),e.restore()}}},{key:\"calculatePosition\",value:function(e,t){e=e||this.state.image;var o=this.getBorders(t),a=h(o,2),n=a[0],i=a[1],r=this.getCroppingRect(),s=e.width*this.props.scale,u=e.height*this.props.scale,c=-r.x*s,d=-r.y*u;return this.isVertical()?(c+=i,d+=n):(c+=n,d+=i),{x:c,y:d,height:u,width:s}}},{key:\"paint\",value:function(e){e.save(),e.scale(m,m),e.translate(0,0),e.fillStyle=\"rgba(\"+this.props.color.slice(0,4).join(\",\")+\")\";var t=this.props.borderRadius,o=this.getDimensions(),a=this.getBorders(o.border),n=h(a,2),i=n[0],r=n[1],s=o.canvas.height,u=o.canvas.width;t=Math.max(t,0),t=Math.min(t,u/2-i,s/2-r),e.beginPath(),v(e,i,r,u-2*i,s-2*r,t),e.rect(u,0,-u,s),e.fill(\"evenodd\"),e.restore()}},{key:\"render\",value:function(){var e=this.getDimensions(),o={width:e.canvas.width,height:e.canvas.height,cursor:this.state.drag?\"grabbing\":\"grab\"},a={width:e.canvas.width*m,height:e.canvas.height*m,style:u({},o,this.props.style)};return a[g.react.down]=this.handleMouseDown,a[g.react.drag]=this.handleDragOver,this.props.disableDrop||(a[g.react.drop]=this.handleDrop),d&&(a[g.react.mouseDown]=this.handleMouseDown),t.createElement(\"canvas\",u({ref:this.setCanvas},a))}}]),r}();return f.propTypes={scale:e.number,rotate:e.number,image:e.oneOfType([e.string].concat(function(e){if(Array.isArray(e)){for(var t=0,o=Array(e.length);t<e.length;t++)o[t]=e[t];return o}return Array.from(e)}(p?[e.instanceOf(File)]:[]))),border:e.oneOfType([e.number,e.arrayOf(e.number)]),borderRadius:e.number,width:e.number,height:e.number,position:e.shape({x:e.number,y:e.number}),color:e.arrayOf(e.number),style:e.object,crossOrigin:e.oneOf([\"\",\"anonymous\",\"use-credentials\"]),onDropFile:e.func,onLoadFailure:e.func,onLoadSuccess:e.func,onImageReady:e.func,onImageChange:e.func,onMouseUp:e.func,onMouseMove:e.func,onPositionChange:e.func,disableDrop:e.bool},f.defaultProps={disableDrop:!1,scale:1,rotate:0,border:25,borderRadius:0,width:200,height:200,color:[0,0,0,.5],style:{},onDropFile:function(){},onLoadFailure:function(){},onLoadSuccess:function(){},onImageReady:function(){},onImageChange:function(){},onMouseUp:function(){},onMouseMove:function(){},onPositionChange:function(){}},f});\n//# sourceMappingURL=index.js.map\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/react-avatar-editor/dist/index.js\n// module id = 80\n// module chunks = 0"],"sourceRoot":""}