{"version":3,"sources":["webpack:///./components/editAlbum/Card.jsx"],"names":["Card","React","Component","constructor","props","replaceEvent","state","imageLoading","imageLoadStarted","componentWillReceiveProps","dragContainer","replaceAttached","addEventListener","e","replaceImage","target","document","body","onUpBody","elementAtPoint","elementFromPoint","clientX","window","scrollX","clientY","scrollY","parentElement","classList","contains","changeDragState","dragStarted","dragFrom","dragObj","dragFromEl","attr","getAttribute","picture","pictures","find","p","_id","changePictureAndClear","onMouseDown","preventDefault","x","y","style","currentStyle","getComputedStyle","elStartLeft","parseInt","left","elStartTop","top","zIndex","onMouseMove","dragState","onMouseUp","event","Event","dispatchEvent","album","newPictures","images","dragToPicture","dragFromPicture","prevOrder","order","sort","newAlbum","Object","assign","updateOrder","onImageLoad","setState","onImageError","Alert","error","loadImage","src","imageObj","Image","onload","bind","onerror","render","openPicture","r","isVideo","deleteItem","openDetails","name"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;IAEMA,I,GAAN,MAAMA,IAAN,SAAmB,6CAAAC,CAAMC,SAAzB,CAAmC;;AAE/BC,gBAAYC,KAAZ,EAAmB;AACf,cAAMA,KAAN;AACA,aAAKC,YAAL,GAAoB,SAApB;AACA,aAAKC,KAAL,GAAa;AACTC,0BAAc,IADL;AAETC,8BAAkB;AAFT,SAAb;AAIH;;AAGDC,gCAA4B;AACxB,YAAI,KAAKC,aAAL,IAAsB,CAAC,KAAKC,eAAhC,EAAiD;AAC7C,iBAAKA,eAAL,GAAuB,IAAvB;AACA,iBAAKD,aAAL,CAAmBE,gBAAnB,CAAoC,KAAKP,YAAzC,EAAuDQ,KAAK,KAAKC,YAAL,CAAkBD,EAAEE,MAApB,CAA5D;AACAC,qBAASC,IAAT,CAAcL,gBAAd,CAA+B,SAA/B,EAA0CC,KAAK,KAAKK,QAAL,CAAcL,CAAd,CAA/C;AACH;AACJ;;AAEDK,aAASL,CAAT,EAAY;AACR,cAAMM,iBAAiBH,SAASI,gBAAT,CAA0BP,EAAEQ,OAAF,GAAYC,OAAOC,OAA7C,EAAsDV,EAAEW,OAAF,GAAYF,OAAOG,OAAzE,EAClBC,aADL;AAEA,YAAI,CAACP,eAAeQ,SAAf,CAAyBC,QAAzB,CAAkC,gBAAlC,CAAL,EAA0D;AACtD,iBAAKxB,KAAL,CAAWyB,eAAX,CAA2B,EAACC,aAAa,KAAd,EAAqBC,UAAU,IAA/B,EAAqCC,SAAS,IAA9C,EAAoDC,YAAY,IAAhE,EAA3B;AACH;AACJ;;AAEDnB,iBAAaC,MAAb,EAAqB;AACjB,cAAMmB,OAAOnB,OAAOoB,YAAP,CAAoB,OAApB,CAAb;AACA,cAAMC,UAAU,KAAKhC,KAAL,CAAWiC,QAAX,CAAoBC,IAApB,CAAyBC,KAAKA,EAAEC,GAAF,IAASN,IAAvC,CAAhB;;AAEA,aAAKO,qBAAL,CAA2BL,OAA3B;AACH;;AAEDM,gBAAY7B,CAAZ,EAAeuB,OAAf,EAAwB;AACpBvB,UAAE8B,cAAF;;AAEA,cAAM5B,SAASF,EAAEE,MAAF,CAASW,aAAxB;;AAEA,cAAMkB,IAAI/B,EAAEQ,OAAF,GAAYC,OAAOC,OAA7B;AACA,cAAMsB,IAAIhC,EAAEW,OAAF,GAAYF,OAAOG,OAA7B;;AAEA,cAAMqB,QAAQ/B,OAAOgC,YAAP,IAAuBzB,OAAO0B,gBAAP,CAAwBjC,MAAxB,CAArC;;AAEA,cAAMkC,cAAcC,SAASJ,MAAMK,IAAf,EAAqB,EAArB,CAApB;AACA,cAAMC,aAAaF,SAASJ,MAAMO,GAAf,EAAoB,EAApB,CAAnB;AACA,cAAMrB,UAAU;AACZY,aADY,EACTC,CADS,EACNI,WADM,EACOG;AADP,SAAhB;AAGArC,eAAO+B,KAAP,CAAaQ,MAAb,GAAsB,EAAtB;AACA,aAAKlD,KAAL,CAAWyB,eAAX,CAA2B,EAACC,aAAa,IAAd,EAAoBC,UAAUK,OAA9B,EAAuCJ,OAAvC,EAAgDC,YAAYlB,MAA5D,EAA3B;AACAA,eAAO+B,KAAP,CAAaQ,MAAb,GAAsB,EAAtB;AACH;;AAEDC,gBAAY1C,CAAZ,EAAeuB,OAAf,EAAwB;AACpBvB,UAAE8B,cAAF;AACA,cAAM,EAACZ,QAAD,EAAWD,WAAX,EAAwBE,OAAxB,KAAmC,KAAK5B,KAAL,CAAWoD,SAApD;AACA,cAAMzC,SAASF,EAAEE,MAAF,CAASW,aAAxB;AACA,YAAII,eAAeC,YAAYK,OAA/B,EAAwC;AACpC,kBAAMQ,IAAI/B,EAAEQ,OAAF,GAAYC,OAAOC,OAA7B;AACA,kBAAMsB,IAAIhC,EAAEW,OAAF,GAAYF,OAAOG,OAA7B;AACAV,mBAAO+B,KAAP,CAAaO,GAAb,GAAoBrB,QAAQoB,UAAR,GAAqBP,CAArB,GAAyBb,QAAQa,CAAlC,GAAuC,IAA1D;AACA9B,mBAAO+B,KAAP,CAAaK,IAAb,GAAqBnB,QAAQiB,WAAR,GAAsBL,CAAtB,GAA0BZ,QAAQY,CAAnC,GAAwC,IAA5D;AACH;AACJ;;AAEDa,cAAU5C,CAAV,EAAauB,OAAb,EAAsB;AAClBvB,UAAE8B,cAAF;;AAEA,cAAM,EAACZ,QAAD,EAAWE,UAAX,KAAyB,KAAK7B,KAAL,CAAWoD,SAA1C;AACA,cAAMzC,SAASF,EAAEE,MAAF,CAASW,aAAxB;;AAEA,YAAG,CAACO,UAAJ,EAAgB;AACZ;AACH;;AAEDA,mBAAWa,KAAX,CAAiBO,GAAjB,GAAuB,KAAvB;AACApB,mBAAWa,KAAX,CAAiBK,IAAjB,GAAwB,KAAxB;;AAEApC,eAAO+B,KAAP,CAAaO,GAAb,GAAmB,KAAnB;AACAtC,eAAO+B,KAAP,CAAaK,IAAb,GAAoB,KAApB;;AAEAlB,mBAAWa,KAAX,CAAiBQ,MAAjB,GAA0B,CAA1B;;AAEA,YAAIlB,WAAWL,QAAf,EAAyB;AACrB,kBAAM2B,QAAQ,IAAIC,KAAJ,CAAU,KAAKtD,YAAf,CAAd;AACA,kBAAMc,iBAAiBH,SAASI,gBAAT,CAA0BP,EAAEQ,OAAF,GAAYC,OAAOC,OAA7C,EAAsDV,EAAEW,OAAF,GAAYF,OAAOG,OAAzE,EAClBC,aADL;AAEA,gBAAIP,eAAeQ,SAAf,CAAyBC,QAAzB,CAAkC,gBAAlC,CAAJ,EAAyD;AACrDT,+BAAeyC,aAAf,CAA6BF,KAA7B;AACH,aAFD,MAEO;AACH,qBAAKtD,KAAL,CAAWyB,eAAX,CAA2B,EAACC,aAAa,KAAd,EAAqBC,UAAU,IAA/B,EAAqCC,SAAS,IAA9C,EAAoDC,YAAY,IAAhE,EAA3B;AACH;;AAED;AACH;;AAED,aAAKQ,qBAAL,CAA2BL,OAA3B;AACH;;AAEDK,0BAAsBL,OAAtB,EAA+B;AAC3B,cAAM,EAACL,QAAD,EAAW8B,KAAX,KAAoB,KAAKzD,KAAL,CAAWoD,SAArC;;AAEA,cAAMM,cAAc,CAAC,GAAGD,MAAME,MAAV,CAApB;;AAEA,cAAMC,gBAAgBH,MAAME,MAAN,CAAazB,IAAb,CAAkBC,KAAKA,EAAEC,GAAF,IAASJ,QAAQI,GAAxC,CAAtB;AACD;AACC,cAAMyB,kBAAkBJ,MAAME,MAAN,CAAazB,IAAb,CAAkBC,KAAKA,EAAEC,GAAF,IAAST,SAASS,GAAzC,CAAxB;;AAEA,cAAM0B,YAAYD,gBAAgBE,KAAlC;AACAF,wBAAgBE,KAAhB,GAAwBH,cAAcG,KAAtC;AACAH,sBAAcG,KAAd,GAAsBD,SAAtB;;AAEAJ,oBAAYM,IAAZ,CAAiB,CAACxB,CAAD,EAAIC,CAAJ,KAAUD,EAAEuB,KAAF,GAAUtB,EAAEsB,KAAvC;;AAEA,cAAME,WAAWC,OAAOC,MAAP,CAAc,EAAd,eACVV,KADU;AAEbE,oBAAQD;AAFK,WAAjB;;AAKA,aAAK1D,KAAL,CAAWoE,WAAX,CAAuBH,QAAvB;AACA,aAAKjE,KAAL,CAAWyB,eAAX,CAA2B,EAACC,aAAa,KAAd,EAAqBC,UAAU,IAA/B,EAAqCC,SAAS,IAA9C,EAAoDC,YAAY,IAAhE,EAAsE4B,OAAOQ,QAA7E,EAA3B;AACH;;AAEDI,kBAAc;AACV,aAAKC,QAAL,CAAc,EAACnE,cAAc,KAAf,EAAd;AACH;;AAEDoE,mBAAe;AACXC,cAAMC,KAAN,CAAY,sBAAZ,EAAoC,EAApC;AACA,aAAKH,QAAL,CAAc,EAACnE,cAAc,KAAf,EAAd;AACH;;AAEDuE,cAAUC,GAAV,EAAe;AACX,aAAKL,QAAL,CAAc,EAAClE,kBAAkB,IAAnB,EAAd;AACA,cAAMwE,WAAW,IAAIC,KAAJ,EAAjB;AACAD,iBAASE,MAAT,GAAkB,KAAKT,WAAL,CAAiBU,IAAjB,CAAsB,IAAtB,CAAlB;AACAH,iBAASI,OAAT,GAAmB,KAAKT,YAAL,CAAkBQ,IAAlB,CAAuB,IAAvB,CAAnB;AACAH,iBAASD,GAAT,GAAeA,GAAf;AACH;;AAEDM,aAAS;AACL,cAAM,EAACjD,OAAD,EAAUkD,WAAV,KAAyB,KAAKlF,KAApC;AACA,cAAM,EAACG,YAAD,EAAeC,gBAAf,KAAmC,KAAKF,KAA9C;AACA,YAAI,CAACE,gBAAD,IAAqB4B,OAAzB,EAAkC,KAAK0C,SAAL,CAAe1C,QAAQ2C,GAAvB;AAClC,eAAOO,cACD;AAAA;AAAA,cAAK,WAAU,gBAAf;AACK,uBAAOlD,QAAQI,GADpB;AAEE,iFAAK,WAAU,YAAf;AACK,qBAAKJ,QAAQ2C,GADlB;AAEK,2BAAW,KAFhB;AAFF,SADC,GAOD;AAAA;AAAA,cAAK,WAAU,gBAAf;AACK,qBAAKQ,KAAK,KAAK7E,aAAL,GAAqB6E,CADpC;AAEK,uBAAOnD,QAAQI,GAFpB;AAGK,2BAAW,IAHhB;AAIK,6BAAa3B,KAAK,KAAK6B,WAAL,CAAiB7B,CAAjB,EAAoBuB,OAApB,CAJvB;AAKK,2BAAWvB,KAAK,KAAK4C,SAAL,CAAe5C,CAAf,EAAkBuB,OAAlB,CALrB;AAMK,6BAAavB,KAAK,KAAK0C,WAAL,CAAiB1C,CAAjB,EAAoBuB,OAApB,CANvB;AAOG7B,2BAAe,4DAAC,qDAAD,IAAQ,MAAK,qBAAb,GAAf,GAAsD,qEAAAiF,CAAQpD,QAAQ2C,GAAhB,IACjD;AAAA;AAAA,kBAAO,QAAQ,sEAAf;AACO,8BAAS,UADhB;AAEO,+BAAU,YAFjB;AAGF,wFAAQ,KAAK3C,QAAQ2C,GAArB;AAHE,aADiD,GAMjD,qEAAK,WAAU,YAAf,EAA4B,KAAK3C,QAAQ2C,GAAzC,GAbR;AAcE,wEAAC,yDAAD,IAAW,WAAU,YAArB,EAAkC,SAAS,MAAM,KAAK3E,KAAL,CAAWqF,UAAX,CAAsBrD,OAAtB,CAAjD,GAdF;AAeE,wEAAC,wDAAD,IAAU,WAAU,WAApB,EAAgC,SAAS,MAAM,KAAKhC,KAAL,CAAWsF,WAAX,CAAuBtD,OAAvB,CAA/C,GAfF;AAgBE;AAAA;AAAA,kBAAK,WAAU,kBAAf,EAAkC,SAAS,MAAM,KAAKhC,KAAL,CAAWsF,WAAX,CAAuBtD,OAAvB,CAAjD;AAAmFA,wBAAQuD;AAA3F;AAhBF,SAPN;AAyBH;AA3K8B,C;;;AA8KnC,yDAAe3F,IAAf,E","file":"0.4aac823fba6722bc795c.hot-update.js","sourcesContent":["import React from 'react';\nimport './editAlbum.less';\nimport {CrossIcon, EditIcon} from \"../Icons\";\nimport {isVideo} from \"../../utils/index\";\nimport Loader from 'react-loaders';\nimport 'loaders.css/src/animations/ball-scale-multiple.scss';\nimport * as styles from \"../../constants/styles\";\n\nclass Card extends React.Component {\n\n    constructor(props) {\n        super(props);\n        this.replaceEvent = 'replace';\n        this.state = {\n            imageLoading: true,\n            imageLoadStarted: false\n        }\n    }\n\n\n    componentWillReceiveProps() {\n        if (this.dragContainer && !this.replaceAttached) {\n            this.replaceAttached = true;\n            this.dragContainer.addEventListener(this.replaceEvent, e => this.replaceImage(e.target));\n            document.body.addEventListener('mouseup', e => this.onUpBody(e));\n        }\n    }\n\n    onUpBody(e) {\n        const elementAtPoint = document.elementFromPoint(e.clientX + window.scrollX, e.clientY + window.scrollY)\n            .parentElement;\n        if (!elementAtPoint.classList.contains('drag_container')) {\n            this.props.changeDragState({dragStarted: false, dragFrom: null, dragObj: null, dragFromEl: null});\n        }\n    }\n\n    replaceImage(target) {\n        const attr = target.getAttribute('imgid');\n        const picture = this.props.pictures.find(p => p._id == attr);\n\n        this.changePictureAndClear(picture);\n    }\n\n    onMouseDown(e, picture) {\n        e.preventDefault();\n\n        const target = e.target.parentElement;\n\n        const x = e.clientX + window.scrollX;\n        const y = e.clientY + window.scrollY;\n\n        const style = target.currentStyle || window.getComputedStyle(target);\n\n        const elStartLeft = parseInt(style.left, 10);\n        const elStartTop = parseInt(style.top, 10);\n        const dragObj = {\n            x, y, elStartLeft, elStartTop\n        }\n        target.style.zIndex = 10;\n        this.props.changeDragState({dragStarted: true, dragFrom: picture, dragObj, dragFromEl: target});\n        target.style.zIndex = 10;\n    }\n\n    onMouseMove(e, picture) {\n        e.preventDefault();\n        const {dragFrom, dragStarted, dragObj} = this.props.dragState;\n        const target = e.target.parentElement;\n        if (dragStarted && dragFrom == picture) {\n            const x = e.clientX + window.scrollX;\n            const y = e.clientY + window.scrollY;\n            target.style.top = (dragObj.elStartTop + y - dragObj.y) + 'px';\n            target.style.left = (dragObj.elStartLeft + x - dragObj.x) + 'px';\n        }\n    }\n\n    onMouseUp(e, picture) {\n        e.preventDefault();\n\n        const {dragFrom, dragFromEl} = this.props.dragState;\n        const target = e.target.parentElement;\n\n        if(!dragFromEl) {\n            return;\n        }\n\n        dragFromEl.style.top = '0px';\n        dragFromEl.style.left = '0px';\n\n        target.style.top = '0px';\n        target.style.left = '0px';\n\n        dragFromEl.style.zIndex = 0;\n\n        if (picture == dragFrom) {\n            const event = new Event(this.replaceEvent);\n            const elementAtPoint = document.elementFromPoint(e.clientX + window.scrollX, e.clientY + window.scrollY)\n                .parentElement;\n            if (elementAtPoint.classList.contains('drag_container')) {\n                elementAtPoint.dispatchEvent(event);\n            } else {\n                this.props.changeDragState({dragStarted: false, dragFrom: null, dragObj: null, dragFromEl: null});\n            }\n\n            return;\n        }\n\n        this.changePictureAndClear(picture);\n    }\n\n    changePictureAndClear(picture) {\n        const {dragFrom, album} = this.props.dragState;\n\n        const newPictures = [...album.images];\n\n        const dragToPicture = album.images.find(p => p._id == picture._id);\n       // editedPicture.order = prevOrder;\n        const dragFromPicture = album.images.find(p => p._id == dragFrom._id);\n\n        const prevOrder = dragFromPicture.order;\n        dragFromPicture.order = dragToPicture.order;\n        dragToPicture.order = prevOrder;\n\n        newPictures.sort((x, y) => x.order - y.order);\n\n        const newAlbum = Object.assign({}, {\n            ...album,\n            images: newPictures,\n        });\n\n        this.props.updateOrder(newAlbum);\n        this.props.changeDragState({dragStarted: false, dragFrom: null, dragObj: null, dragFromEl: null, album: newAlbum});\n    }\n\n    onImageLoad() {\n        this.setState({imageLoading: false});\n    }\n\n    onImageError() {\n        Alert.error(\"Image loading failed\", {});\n        this.setState({imageLoading: false});\n    }\n\n    loadImage(src) {\n        this.setState({imageLoadStarted: true});\n        const imageObj = new Image();\n        imageObj.onload = this.onImageLoad.bind(this);\n        imageObj.onerror = this.onImageError.bind(this);\n        imageObj.src = src;\n    }\n\n    render() {\n        const {picture, openPicture} = this.props;\n        const {imageLoading, imageLoadStarted} = this.state;\n        if (!imageLoadStarted && picture) this.loadImage(picture.src);\n        return openPicture\n            ? <div className='drag_container'\n                   imgid={picture._id}>\n                <img className='drag_image'\n                     src={picture.src}\n                     draggable={false}/>\n            </div>\n            : <div className='drag_container'\n                   ref={r => this.dragContainer = r}\n                   imgid={picture._id}\n                   draggable={true}\n                   onMouseDown={e => this.onMouseDown(e, picture)}\n                   onMouseUp={e => this.onMouseUp(e, picture)}\n                   onMouseMove={e => this.onMouseMove(e, picture)}>\n                {imageLoading ? <Loader type=\"ball-scale-multiple\"/> : isVideo(picture.src)\n                    ? <video height={styles.picture_edit_height}\n                             controls=\"controls\"\n                             className='drag_image'>\n                    <source src={picture.src}/>\n                </video>\n                    : <img className='drag_image' src={picture.src}/>}\n                <CrossIcon className='cross_icon' onClick={() => this.props.deleteItem(picture)}/>\n                <EditIcon className='edit_icon' onClick={() => this.props.openDetails(picture)}/>\n                <div className='text_description' onClick={() => this.props.openDetails(picture)}>{picture.name}</div>\n            </div>\n    }\n}\n\nexport default Card;\n\n\n\n// WEBPACK FOOTER //\n// ./components/editAlbum/Card.jsx"],"sourceRoot":""}