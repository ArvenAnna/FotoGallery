{"version":3,"sources":["webpack:///./components/editAlbum/EditCanvas.jsx"],"names":["routesModule","require","EditCanvas","React","Component","constructor","props","state","angle","width","height","getEditedImage","album","image","avatar","getImage","toBlob","img","name","split","length","file","File","http","sendFile","routes","UPLOAD_FOTO","then","downloadedFoto","doPost","FOTO_ROUTE","src","_id","result","newPictures","images","push","newAlbum","Object","assign","cleanImage","imageDownloaded","rotateImage","setState","onLoad","imgInfo","naturalWidth","resource","naturalHeight","onChangeImage","render","ae"],"mappings":"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","file":"0.a264f2cc23cd9a785c32.hot-update.js","sourcesContent":["import React from 'react';\nimport './editCanvas.less';\nimport {CrossIcon, EditIcon, RotateIcon, SaveIcon} from \"../Icons\";\nimport AvatarEditor from \"react-avatar-editor\";\nconst routesModule = require('../../constants/routes');\nimport http from '../../HttpService';\n\nclass EditCanvas extends React.Component {\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            angle: 0,\n            width: 200,\n            height: 200\n        }\n    }\n\n    getEditedImage() {\n        const {album, image} = this.props;\n        this.avatar.getImage().toBlob(img => {\n            let name = image.split('/');\n            name = name[name.length - 1];\n            const file = new File([img], name);\n\n            http.sendFile(routesModule.routes.UPLOAD_FOTO, file)\n                .then(downloadedFoto => {\n                    http.doPost(routesModule.routes.FOTO_ROUTE, {\n                        src: downloadedFoto.src,\n                        album: album._id\n                    }).then(result => {\n                            const newPictures = [...album.images];\n                            newPictures.push(result);\n                            const newAlbum = Object.assign({}, {\n                                ...album,\n                                images: newPictures,\n                            });\n\n                            this.props.cleanImage({\n                                imageDownloaded: null,\n                                album: newAlbum\n                            });\n                        });\n                });\n        });\n    }\n\n    rotateImage() {\n        this.setState({\n            angle : this.state.angle + 90\n        })\n    }\n\n    onLoad(imgInfo) {\n        this.naturalWidth = imgInfo.resource.naturalWidth;\n        this.naturalHeight = imgInfo.resource.naturalHeight;\n\n        this.setState({\n            width: imgInfo.resource.naturalWidth * this.state.height / imgInfo.resource.naturalHeight,\n        });\n    }\n\n    onChangeImage() {\n        if(this.state.angle % 180 == 0) {\n            this.setState({\n                width: this.naturalWidth * this.state.height / this.naturalHeight,\n                height: 200\n            });\n        } else {\n            this.setState({\n                width: this.naturalHeight * this.state.height / this.naturalWidth,\n                height: 200\n            });\n        }\n    }\n\n    render() {\n        const {image} = this.props;\n        const {angle, width, height} = this.state;\n        return <div className=\"Edit_canvas\">\n            <AvatarEditor\n                ref={ae => this.avatar = ae}\n                image={image}\n                rotate={angle}\n                width={width}\n                height={height}\n                onLoadSuccess={(imgInfo) => this.onLoad(imgInfo)}\n                onImageChange={() => this.onChangeImage()}\n                // onDropFile={() => this.onChangeImage()}\n                // onImageReady={() => this.onChangeImage()}\n                //\n                // onPositionChange={() => this.onChangeImage()}\n\n            />\n            <RotateIcon className='rotate_icon' onClick={() => this.rotateImage()}/>\n            <SaveIcon className='save_icon' onClick={() => this.getEditedImage()}/></div>\n    }\n}\n\nexport default EditCanvas;\n\n\n\n// WEBPACK FOOTER //\n// ./components/editAlbum/EditCanvas.jsx"],"sourceRoot":""}